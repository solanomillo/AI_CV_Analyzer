{% extends 'base.html' %}
{% load static %}

{% block title %}Resultados | AI CV Analyzer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/result.css' %}">
{% endblock %}

{% block content %}
<div class="result-page"> <!-- WRAPPER PRINCIPAL ESPEC칈FICO -->
    <div class="container">
        <!-- Encabezado de resultados -->
        <header class="result-header result-fade-in text-center">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <h1 class="result-header-title mb-3">游늵 Resultados del An치lisis</h1>
                    <p class="result-header-subtitle mb-4">
                        An치lisis completo de tu curr칤culum generado por inteligencia artificial
                    </p>
                    
                    {% if analysis.get_target_position_display %}
                    <div class="d-inline-flex align-items-center position-badge mb-4">
                        <i class="bi bi-briefcase-fill"></i>
                        <span>{{ analysis.get_target_position_display }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="d-flex flex-wrap justify-content-center gap-3">
                        <div class="text-center">
                            <div class="text-success fw-bold fs-4 mb-1">
                                {% if analysis.result_json.strengths %}
                                    {{ analysis.result_json.strengths|length }}
                                {% else %}
                                    0
                                {% endif %}
                            </div>
                            <div class="text-light-emphasis small">Fortalezas</div>
                        </div>
                        <div class="text-center">
                            <div class="text-danger fw-bold fs-4 mb-1">
                                {% if analysis.result_json.errors %}
                                    {{ analysis.result_json.errors|length }}
                                {% else %}
                                    0
                                {% endif %}
                            </div>
                            <div class="text-light-emphasis small">Errores</div>
                        </div>
                        <div class="text-center">
                            <div class="text-warning fw-bold fs-4 mb-1">
                                {% if analysis.result_json.suggestions %}
                                    {{ analysis.result_json.suggestions|length }}
                                {% else %}
                                    0
                                {% endif %}
                            </div>
                            <div class="text-light-emphasis small">Sugerencias</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Resultados principales -->
        <div class="row g-4 mb-5">
            <!-- Fortalezas -->
            <div class="col-lg-4 result-fade-in">
                <div class="result-card">
                    <div class="result-card-header strengths">
                        <i class="bi bi-check-circle-fill"></i>
                        <span>Fortalezas Detectadas</span>
                    </div>
                    <div class="result-card-body">
                        {% if analysis.result_json.strengths %}
                            <div class="d-flex flex-wrap gap-2">
                                {% for item in analysis.result_json.strengths %}
                                    <span class="result-badge strength">
                                        <i class="bi bi-check-lg"></i>
                                        {{ item }}
                                    </span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="result-empty-state">
                                <i class="bi bi-emoji-neutral"></i>
                                <p class="mb-0">No se detectaron fortalezas espec칤ficas.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Errores -->
            <div class="col-lg-4 result-fade-in" style="animation-delay: 0.1s;">
                <div class="result-card">
                    <div class="result-card-header errors">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <span>Errores a Corregir</span>
                    </div>
                    <div class="result-card-body">
                        {% if analysis.result_json.errors %}
                            <ul class="result-list">
                                {% for item in analysis.result_json.errors %}
                                    <li class="result-list-item error">
                                        <div class="icon">
                                            <i class="bi bi-x-lg"></i>
                                        </div>
                                        <div class="result-list-item-content">{{ item }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="result-empty-state">
                                <i class="bi bi-emoji-smile"></i>
                                <p class="mb-0">춰Excelente! No se detectaron errores cr칤ticos.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sugerencias -->
            <div class="col-lg-4 result-fade-in" style="animation-delay: 0.2s;">
                <div class="result-card">
                    <div class="result-card-header suggestions">
                        <i class="bi bi-lightbulb-fill"></i>
                        <span>Sugerencias de Mejora</span>
                    </div>
                    <div class="result-card-body">
                        {% if analysis.result_json.suggestions %}
                            <ul class="result-list">
                                {% for item in analysis.result_json.suggestions %}
                                    <li class="result-list-item suggestion">
                                        <div class="icon">
                                            <i class="bi bi-arrow-right"></i>
                                        </div>
                                        <div class="result-list-item-content">{{ item }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <div class="result-empty-state">
                                <i class="bi bi-info-circle"></i>
                                <p class="mb-0">No hay sugerencias espec칤ficas en este momento.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen ATS Optimizado -->
        <div class="row mb-5 result-fade-in" style="animation-delay: 0.3s;">
            <div class="col-12">
                <div class="result-card">
                    <div class="result-card-header summary">
                        <i class="bi bi-robot"></i>
                        <span>Resumen Optimizado para ATS</span>
                    </div>
                    <div class="result-card-body">
                        {% if analysis.result_json.optimized_summary %}
                            <div class="summary-box">
                                {{ analysis.result_json.optimized_summary|linebreaks }}
                            </div>
                            <div class="mt-3 text-light-emphasis small">
                                <i class="bi bi-info-circle me-1"></i>
                                Este resumen est치 optimizado para sistemas de seguimiento de candidatos (ATS) y reclutadores humanos.
                            </div>
                        {% else %}
                            <div class="result-empty-state">
                                <i class="bi bi-file-earmark-text"></i>
                                <p class="mb-0">No se gener칩 un resumen optimizado.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Informaci칩n adicional del an치lisis -->
        {% if analysis.result_json.score or analysis.result_json.ats_compatibility %}
        <div class="row mb-4 result-fade-in" style="animation-delay: 0.4s;">
            <div class="col-12">
                <div class="card border-0 bg-dark bg-opacity-50">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-3">
                            <i class="bi bi-graph-up me-2"></i> M칠tricas del An치lisis
                        </h5>
                        <div class="row">
                            {% if analysis.result_json.score %}
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                                        <i class="bi bi-star-fill text-success fs-4"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold fs-3">{{ analysis.result_json.score }}/100</div>
                                        <div class="text-light-emphasis">Puntuaci칩n general</div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if analysis.result_json.ats_compatibility %}
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-info bg-opacity-10 rounded-circle p-3 me-3">
                                        <i class="bi bi-shield-check text-info fs-4"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold fs-3">{{ analysis.result_json.ats_compatibility }}%</div>
                                        <div class="text-light-emphasis">Compatibilidad ATS</div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Acciones -->
        <div class="row result-fade-in" style="animation-delay: 0.5s;">
            <div class="col-12">
                <div class="result-actions text-center">
                    <div class="d-flex flex-wrap justify-content-center gap-3">
                        <a href="/" class="result-btn result-btn-new">
                            <i class="bi bi-plus-circle"></i>
                            <span>Nuevo An치lisis</span>
                        </a>
                        
                        {% if analysis.id %}
                        <a href="{% url 'download_summary' analysis.id %}" class="result-btn result-btn-download">
                            <i class="bi bi-download"></i>
                            <span>Descargar Resumen (PDF)</span>
                        </a>
                        {% endif %}
                        
                        <a href="/historial/" class="btn btn-outline-light btn-lg px-4">
                            <i class="bi bi-clock-history me-2"></i>
                            Ver Historial
                        </a>
                    </div>
                    
                    <div class="mt-4 text-light-emphasis small">
                        <i class="bi bi-clock me-1"></i>
                        An치lisis generado el {{ analysis.created_at|date:"d/m/Y H:i" }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- CIERRE DEL WRAPPER PRINCIPAL -->
{% endblock %}

{% block extra_js %}
<script>
    src='{% static "js/result.js" %}'
</script>
{% endblock %}